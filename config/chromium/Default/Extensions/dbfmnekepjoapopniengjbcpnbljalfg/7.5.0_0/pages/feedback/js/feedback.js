"use strict";!function(){var v=chrome.runtime.getManifest(),g=new InfinityGa({trackingId:"UA-130509779-1"});document.title=feedbackI18n.get("feedback_suggestion")+" - "+v.name;var c=document.getElementById("submit"),y=document.getElementById("text"),f=document.querySelector(".loading-out"),p=(document.querySelector(".spinner"),document.querySelector(".fb-email")),e=document.querySelector(".wp-upload"),m=/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/i;function h(){alert(feedbackI18n.get("feedback_success")),window.close()}var d=0;e.addEventListener("click",function(){infinity.chooseFile(null,function(e){var t=document.querySelector(".screen-shot-out"),n=document.querySelector(".icon-upload"),i=document.createElement("div");c.classList.add("icon-upload-disabled"),3<=d&&(n.style.display="none"),n.classList.add("icon-upload-disabled"),i.className="screen-shot-loading-out",i.innerHTML='<div class="screen-shot-loading-cover"></div><div class="screen-shot-failed-cover"></div><div class="screen-shot-loading spinner"><div class="bounce1"></div><div class="bounce2"></div><div class="bounce3"></div></div><div class="screen-shot" style="background-image:url('+e.url+')"></div><div class="delete-upload"></div>',t.appendChild(i);var s=i.querySelector(".screen-shot-failed-cover"),a=i.querySelector(".delete-upload"),o=i.querySelector(".screen-shot-loading-cover"),l=i.querySelector(".screen-shot-loading");a.addEventListener("click",function(){"ok"==i.getAttribute("status")&&--d,d<4&&(n.style.display="block"),i.remove()}),infinity.uploadToQiniu(e.file,function(e){o.style.display="none",l.style.display="none",n.classList.remove("icon-upload-disabled"),a.style.display="block",e?(i.setAttribute("status","ok"),i.setAttribute("data-src",e),d+=1):(i.setAttribute("status","failed"),s.style.display="block"),c.classList.remove("icon-upload-disabled")})})}),c.addEventListener("click",function(){var e=y.value,t=p.value;if(""!=e.replace(/\s/g,""))if(""==t.replace(/\s/g,"")||m.test(t)){f.style.display="flex";for(var n=document.querySelectorAll(".screen-shot-loading-out"),n=Array.prototype.slice.call(n).map(function(e,t){return e.dataset.src}),e=URLSafeBase64.encode(e),i=splitter(e,350),s=[],a=Date.now()+""+randomString(2),o="N6taADrSL",l=0;l<i.length;l++){var c={a:a,t:"f",i:l,x:i[l],z:o};s.push(c)}e={a:a,t:"i",l:chrome.i18n.getUILanguage(),v:v.version,s:!!v.hasOwnProperty("update_url"),w:window.screen.width,h:window.screen.height,d:window.devicePixelRatio,u:window.navigator.userAgent,to:"ontouchstart"in window,z:o},t={a:a,t:"e",e:t,z:o},n={a:a,t:"g",s:n,z:o};s.push(e,t,n);for(var d=0,r={s:"q9npW5P",n:DISPLAY_NAME.substr(0,30)},l=0;l<s.length;l++){var u=s[l];g.event({category:JSON.stringify(r),action:JSON.stringify(u)},function(){(d+=1)==s.length&&h()},function(){(d+=1)==s.length&&h()})}}else alert(feedbackI18n.get("please_input_valid_email"));else alert(feedbackI18n.get("please_input_feedback_first"))})}();