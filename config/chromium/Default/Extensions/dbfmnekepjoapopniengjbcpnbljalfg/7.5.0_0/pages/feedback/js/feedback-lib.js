"use strict";var infinity={};function randomString(e){for(var t="",n="abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789",r=0;r<e;r++)t+=n.charAt(Math.floor(Math.random()*n.length));return t}function splitter(e,t){for(var n=[];e.length>t;){var r=(r=e.substring(0,t).lastIndexOf(" "))<=0?t:r;n.push(e.substring(0,r));var i=e.indexOf(" ",r)+1;(i<r||r+t<i)&&(i=r),e=e.substring(i)}return n.push(e),n}infinity.chooseFile=function(e,r){function t(e){var t=this.files[0],n=URL.createObjectURL(t);r&&r({file:t,url:n})}e=e||"image/jpg,image/jpeg,image/png,image/gif,image/bmp,image/webp,image/svg",window.$file=document.createElement("input"),window.$file.setAttribute("type","file"),window.$file.setAttribute("accept",e),window.$file.value="",window.$file.removeEventListener("change",t,!1),window.$file.addEventListener("change",t,!1),window.$file.click()},infinity.getQiniuToken=function(e,t,r){var n="https://infinity-api.infinitynewtab.com/feedbacktoken?filename="+t+"&rt="+Date.now(),t=new XMLHttpRequest;t.open("GET",n,!0),t.timeout=e||0,t.onload=function(e){try{var t=e.target,n=JSON.parse(t.response);if(200!==t.status)throw new Error(n.error);r&&r(n.token)}catch(e){r&&r(null)}},t.ontimeout=function(e){r&&r(null)},t.onerror=function(e){r&&r(null)},t.send()},infinity.uploadToQiniu=function(r,i){var o=randomString(20)+".png";infinity.getQiniuToken(3e3,o,function(e){var t,n;e?(t=new FormData,n="feedback/images/"+o,t.append("key",n),t.append("token",e),t.append("file",r),(e=new XMLHttpRequest).open("POST","http://up-z2.qiniup.com",!0),e.timeout=1e4,e.onload=function(e){try{var t=e.target,n=JSON.parse(t.response);if(200!==t.status)throw new Error(n.error);n="https://best-extension.extfans.com/"+n.key;i&&i(n)}catch(e){i&&i(null)}},e.ontimeout=function(e){i&&i(null)},e.onerror=function(e){i&&i(null)},e.send(t)):i&&i(null)})};var Base64={_keyStr:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",encode:function(e){var t,n,r,i,o,a,f="",c=0;for(e=Base64._utf8_encode(e);c<e.length;)r=(a=e.charCodeAt(c++))>>2,i=(3&a)<<4|(t=e.charCodeAt(c++))>>4,o=(15&t)<<2|(n=e.charCodeAt(c++))>>6,a=63&n,isNaN(t)?o=a=64:isNaN(n)&&(a=64),f=f+this._keyStr.charAt(r)+this._keyStr.charAt(i)+this._keyStr.charAt(o)+this._keyStr.charAt(a);return f},decode:function(e){var t,n,r,i,o,a="",f=0;for(e=e.replace(/[^A-Za-z0-9\+\/\=]/g,"");f<e.length;)t=this._keyStr.indexOf(e.charAt(f++))<<2|(r=this._keyStr.indexOf(e.charAt(f++)))>>4,n=(15&r)<<4|(i=this._keyStr.indexOf(e.charAt(f++)))>>2,r=(3&i)<<6|(o=this._keyStr.indexOf(e.charAt(f++))),a+=String.fromCharCode(t),64!=i&&(a+=String.fromCharCode(n)),64!=o&&(a+=String.fromCharCode(r));return Base64._utf8_decode(a)},_utf8_encode:function(e){e=e.replace(/\r\n/g,"\n");for(var t="",n=0;n<e.length;n++){var r=e.charCodeAt(n);r<128?t+=String.fromCharCode(r):(127<r&&r<2048?t+=String.fromCharCode(r>>6|192):(t+=String.fromCharCode(r>>12|224),t+=String.fromCharCode(r>>6&63|128)),t+=String.fromCharCode(63&r|128))}return t},_utf8_decode:function(e){for(var t,n,r="",i=0,o=0;i<e.length;)(t=e.charCodeAt(i))<128?(r+=String.fromCharCode(t),i++):191<t&&t<224?(o=e.charCodeAt(i+1),r+=String.fromCharCode((31&t)<<6|63&o),i+=2):(o=e.charCodeAt(i+1),n=e.charCodeAt(i+2),r+=String.fromCharCode((15&t)<<12|(63&o)<<6|63&n),i+=3);return r}},URLSafeBase64_ENC={"+":"-","/":"_","=":"."},URLSafeBase64_DEC={"-":"+",_:"/",".":"="},URLSafeBase64={encode:function(e){return Base64.encode(e).replace(/[+/=]/g,function(e){return URLSafeBase64_ENC[e]})},decode:function(e){return e=e.replace(/[-_.]/g,function(e){return URLSafeBase64_DEC[e]}),Base64.decode(e)}};