"use strict";infinity.modules["notes-notes"]=function(){return new Vue({el:"#v-notes",data:{notes:{}},created:function(){var t=this;$(document).on("click",".notes-content a",function(t){t.preventDefault();t=$(this).attr("href");window.open(t,"_blank")}),t.handleMessage(),t.updateData(function(){t.onOpen()})},methods:{close:function(){iView.hideSideBar()},onOpen:function(){$(".i-notes").on("transitionend",function(t){0<=t.target.className.indexOf("i-notes")&&0<=t.target.className.indexOf("i-side-show")&&setTimeout(function(){$("#notes-content")[0].focus()},50)})},handleMessage:function(){var t=this;infinity.onMessage("notesDataUpdate",function(){t.updateData()}),infinity.onMessage("onRecoverySetView",function(){t.updateData()})},updateData:function(e){var n=this;infinity.get("infinity-data",!0,function(t){t.notes.map(function(t){t.__select__=!1}),n.notes=t.notes,n.setSelect(n.notes[0],!0),n.fillText(n.notes[0]),e&&e()})},saveAndSync:function(){var e=this;infinity.get("infinity-data",!0,function(t){t.notes=e.notes,infinity.set("infinity-data",t,!0,function(){infinity.sendMessage("notesDataUpdate"),infinity.sendMessage("backupToCloud")})})},setSelect:function(t){this.notes.map(function(t){t.__select__=!1}),t.__select__=!0},changeNote:function(t){var e=this;e.setSelect(t,!0),e.fillText(t),e.setCaretPosition(e.$refs.noteInput,e.$refs.noteInput.innerHTML.length)},deleteIt:function(t,e){var n=this;t.stopPropagation();e=n.notes.indexOf(e);n.notes.splice(e,1),n.saveAndSync()},newNote:function(){var t=this,e={text:"",__select__:!0,time:(new Date).getTime()};t.notes.unshift(e),t.setSelect(e,!0),t.fillText(e),t.$refs.noteInput.focus(),t.saveAndSync()},write:function(t){t.preventDefault();var e=this,n=$(".notes-content").html(),t=e.notes.filter(function(t,e){return t.__select__});t[0].time=(new Date).getTime(),t[0].text=e.autoLink(n),e.saveAndSync()},fillText:function(t){$(".notes-content").html(t.text)},transHtml:function(t){for(var e=(t=t.replace(/<\/p>/gi,"</p>\n")).match(/<img.*?(?:>|\/>)/gi),n=0;n<e.length;n++){var i=$(e[n]).attr("src");t=t.replace(e[n],'<p>\n{{{"infinity-src":"'+i+'"}}}\n</p>')}for(var a=(s=$("<div>"+t+"</div>").text()).match(/{{{"infinity-src":".*"}}}/gi),n=0;n<a.length;n++)var o='<img src="'+JSON.parse(a[n].replace("{{","").replace("}}",""))["infinity-src"]+'">',s=s.replace(a[n],o);return s=this.autoLink(s.replace(/\n/gi,"<br>")),$.trim(s)},autoLink:function(c){var r=[].slice;return function(){var i,e,a,n,o,t=1<=arguments.length?r.call(arguments,0):[],s=/(^|[\s\n]|<[A-Za-z]*\/?>)((?:https?|ftp):\/\/[\-A-Z0-9+\u0026\u2019@#\/%?=()~_|!:,.;]*[\-A-Z0-9+\u0026@#\/%=~()_|])/gi;return 0<t.length?(n=t[0],i=n.callback,a=function(){var t=[];for(e in n)o=n[e],"callback"!==e&&t.push(" "+e+"='"+o+"'");return t}().join(""),c.replace(s,function(t,e,n){return""+e+(("function"==typeof i?i(n):void 0)||"<a href='"+n+"'"+a+">"+n+"</a>")})):c.replace(s,"$1<a href='$2'>$2</a>")}()},trim:function(t){var e=document.createElement("div");e.innerHTML=t;e=e.innerText;return $.trim(e)},paste:function(e){e.preventDefault();var n="";try{var t=e.clipboardData.getData("text/html");n=this.transHtml(t,e)}catch(t){try{n=e.clipboardData.getData("text/plain");n=n.replace(/\n/gi,"<br>");n=$.trim(n),n=this.autoLink(n)}catch(t){n=""}}document.execCommand("insertHtml",!1,n)},setCaretPosition:function(){try{var t=(i=document.getElementById("notes-content")).childNodes.length,e=document.createRange(),n=window.getSelection();e.setStart(i.childNodes[t-1],i.innerHTML.length),e.collapse(!0),n.removeAllRanges(),n.addRange(e),i.focus()}catch(t){var i;(i=document.getElementById("notes-content")).focus()}}}})};