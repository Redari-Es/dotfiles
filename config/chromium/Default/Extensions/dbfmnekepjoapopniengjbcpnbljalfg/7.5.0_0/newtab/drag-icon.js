"use strict";var infinityDrag={dragSlideLock:!1,dragShadow:document.createElement("div"),dragShadowHide:document.createElement("div"),isDraging:!1,init:function(){var e=this;e.ondrag(),e.dragShadow.className="home-drag-shadow",$(e.dragShadow).html('<div class="home-drag-img BORDERRADIUS" id="home-drag-img"></div>'),e.dragShadowHide.className="home-drag-shadow home-drag-shadow-hide",$(e.dragShadowHide).html('<div class="home-drag-img BORDERRADIUS" id="home-drag-img"></div>')},start:{},end:{},setDropPosition:function(a,n,t){var d=n;return a[n].length<=t?a:function e(){var i=0;return a[d+=1]?a[d].length>t?(i=a[d-1][t],a[d].unshift(i),a[n].splice(t,1),void e()):(i=a[d-1][t],a[d].unshift(i),a[n].splice(t,1),a):(i=a[d-1][t],a[d]=[],a[d].unshift(i),a[n].splice(t-1,1),a)}()},checkEndPageIsFull:function(){var e=this;if(e.start.page!=e.end.page){if(SETTING.row*SETTING.column<=$(".group:nth-child("+(e.end.page+1)+")").children(".icon-item-out").length)return infinity.alert({html:infinity.i18n("this_page_no_space")}),!0;infinity.alertHide()}else infinity.alertHide();return!1},ondrag:function(){var t=this;t.isDraging=!0,$(document).on("drag",".icon-item-out",function(e){$(this).before(t.dragShadow),$(t.dragShadow).show(),$(this).remove()}),$(document).on("dragstart",".icon-item-out",function(e){try{iEditDelete.end()}catch(e){}var i=$(this),i=(infinity.get("infinity-icons").length,i.index());t.start={page:_app.data.currentPage,position:i},t.end={page:_app.data.currentPage,position:i},$(".home-drag-hover").css("display","flex"),infinity.log(this),this.ondragend=function(){t.isDraging=!1;var e=$(t.dragShadow).index();t.end.position=e,t.end.page=_app.data.currentPage;var i=SETTING.row*SETTING.column,a=infinity.get("infinity-icons"),n=a[t.end.page].length,e=a[t.start.page][t.start.position];t.start.page==t.end.page?(a[t.start.page].splice(t.start.position,1),a[t.end.page].splice(t.end.position,0,e)):i<=n||(a[t.end.page].splice(t.end.position,0,e),t.setDropPosition(a,t.end.page,i),e=a[t.start.page].indexOf(e),a[t.start.page].splice(e,1)),a[t.start.page].length||a.splice(t.start.page,1),_app.data.groups=a,_app.render(),infinity.set("infinity-icons",a),$(".home-drag-hover").css("display","none"),infinity.sendMessage("icon-handle",{type:"drag",page:t.end.page}),infinity.sendMessage("backupToCloud"),infinity.alertHide()}}),$(".home-drag-hover").on("dragenter",function(e){$(this).addClass("home-drag-hover-show");var i=parseInt($(this).attr("data-direction"));t.dragSlideLock||(t.dragSlideLock=!0,i?iView.slideToLeft(function(){var e;iView.setPoniter(),t.end.page=_app.data.currentPage,t.dragSlideLock=!1,iView.lock=!1,t.checkEndPageIsFull()||(e=_app.data.currentPage+1,e=$(".group:nth-child("+e+")").find(".icon-item-out:last-child")[0],t.isDraging&&$(t.dragShadow).insertAfter(e))}):iView.slideToRight(function(){var e;iView.setPoniter(),t.end.page=_app.data.currentPage,t.dragSlideLock=!1,iView.lock=!1,t.checkEndPageIsFull()||(e=_app.data.currentPage+1,e=$(".group:nth-child("+e+")").find(".icon-item-out:last-child")[0],t.isDraging&&$(t.dragShadow).insertAfter(e))}))}),$(".home-drag-hover").on("dragleave",function(e){$(".home-drag-hover").removeClass("home-drag-hover-show")}),$(document).on("dragover",".item-icon",function(e){e.preventDefault();e=this;t.end.page=$(e).parents(".group").index(".group"),t.checkEndPageIsFull()||($(t.dragShadow).index()<$(e.parentNode).index()?$(t.dragShadow).insertAfter(e.parentNode):$(t.dragShadow).insertBefore(e.parentNode))})}};infinityDrag.init();