(window.webpackJsonp=window.webpackJsonp||[]).push([[6],{129:function(e,t,n){"use strict";var a=n(12),r=n(21),s=function(){return r.a.Date.now()},c=n(30),o=Math.max,l=Math.min;t.a=function(e,t,n){var r,i,u,d,m,f,p=0,v=!1,b=!1,g=!0;if("function"!=typeof e)throw new TypeError("Expected a function");function E(t){var n=r,a=i;return r=i=void 0,p=t,d=e.apply(a,n)}function O(e){return p=e,m=setTimeout(h,t),v?E(e):d}function y(e){var n=e-f;return void 0===f||n>=t||n<0||b&&e-p>=u}function h(){var e=s();if(y(e))return j(e);m=setTimeout(h,function(e){var n=t-(e-f);return b?l(n,u-(e-p)):n}(e))}function j(e){return m=void 0,g&&r?E(e):(r=i=void 0,d)}function C(){var e=s(),n=y(e);if(r=arguments,i=this,f=e,n){if(void 0===m)return O(f);if(b)return clearTimeout(m),m=setTimeout(h,t),E(f)}return void 0===m&&(m=setTimeout(h,t)),d}return t=Object(c.a)(t)||0,Object(a.a)(n)&&(v=!!n.leading,u=(b="maxWait"in n)?o(Object(c.a)(n.maxWait)||0,t):u,g="trailing"in n?!!n.trailing:g),C.cancel=function(){void 0!==m&&clearTimeout(m),p=0,r=f=i=m=void 0},C.flush=function(){return void 0===m?d:j(s())},C}},161:function(e,t,n){"use strict";String.prototype.matchAll||(String.prototype.matchAll=function*(e){const t=new RegExp(e,e.flags),n=this.toString();let a;for(;a=t.exec(n);)yield a})},200:function(e,t,n){},213:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var a=n(11),r=n(109),s="undefined"!=typeof document?new r.a(document.documentElement,a.FOCUS_DISABLED):{isActive:function(){return!0},start:function(){return!0},stop:function(){return!0}},c={alwaysShowFocus:function(){return s.stop()},isActive:function(){return s.isActive()},onlyShowFocusOnTabs:function(){return s.start()}}},298:function(e,t,n){"use strict";var a=n(105);t.a=function(e,t,n){return null==e?e:Object(a.a)(e,t,n)}},299:function(e,t,n){"use strict";n.d(t,"a",(function(){return r}));var a=n(0);function r(e){var t=Object(a.useRef)();return Object(a.useEffect)((function(){t.current=e})),t.current}},30:function(e,t,n){"use strict";var a=n(12),r=n(34),s=/^\s+|\s+$/g,c=/^[-+]0x[0-9a-f]+$/i,o=/^0b[01]+$/i,l=/^0o[0-7]+$/i,i=parseInt;t.a=function(e){if("number"==typeof e)return e;if(Object(r.a)(e))return NaN;if(Object(a.a)(e)){var t="function"==typeof e.valueOf?e.valueOf():e;e=Object(a.a)(t)?t+"":t}if("string"!=typeof e)return 0===e?e:+e;e=e.replace(s,"");var n=o.test(e);return n||l.test(e)?i(e.slice(2),n?2:8):c.test(e)?NaN:+e}},53:function(e,t,n){"use strict";n.d(t,"b",(function(){return c})),n.d(t,"a",(function(){return o}));var a=n(67);let r,s=()=>{s=a.a,r=document.createElement("textarea"),r.style.position="absolute",r.style.top="-99999px",document.body.appendChild(r)};function c(e){s(),r.value=e,r.select(),document.execCommand("copy")}function o(){return s(),r.value="",r.focus(),document.execCommand("paste"),r.value}},63:function(e,t,n){"use strict";n.d(t,"a",(function(){return F}));n(161);var a=n(0),r=n.n(a),s=n(173),c=n(111),o=n(86),l=n(129),i=n(300),u=n(10),d=n(6),m=n(45);const f=Object(o.a)(d.a,"selectedAPIs");function p(){const[e,t]=Object(u.a)(f);return r.a.createElement(r.a.Fragment,null,m.a.map((n=>r.a.createElement(s.x,{key:n.value,text:n.name,onClick:()=>(e=>{const n=e.value;t((e=>{const t=e.selectedAPIs;t.indexOf(n)<0&&t.push(n)}))})(n),disabled:!e||e.selectedAPIs.includes(n.value)}))))}var v=n(14),b=n(156);let g="";const E=document.querySelector('link[rel=icon],link[rel="shortcut icon"]');g=E?E.href:window.location.origin+"/favicon.ico";const O=Object(v.b)(((e,t)=>{switch(t.type){case"save translate record":const n=Date.now(),a=Object(b.a)(n+"-");return e.translateId=a,void browser.runtime.sendMessage({action:"save history record",record:{text:t.text,date:n,url:window.location.href,title:document.title,favicon:g}})}}));var y=n(52);const h={small:12,middle:16,large:20};function j(){browser.runtime.sendMessage({action:"open options page",suffix:"?vip#/#通用设置"})}function C(){browser.runtime.sendMessage({action:"open options page"})}function x(e){const{source:t,setSource:n,options:a,setOptions:c,user:o,children:l,rightOffset:i,size:u}=e;if(!a)return null;const d="large"===u,f=(e,t)=>{c((n=>{const a=n[t],r=a.indexOf(e);r>=0?a.splice(r,1):4===a.length&&a.pop(),a.unshift(e)}))};return r.a.createElement(s.f,{className:"quick-settings"},r.a.createElement("div",null,r.a.createElement(y.a,{lang:t,setLang:e=>{n(e),f(e,"recentUseLangFrom")},addAuto:!0,recentUse:a.recentUseLangFrom,size:u}),r.a.createElement(s.t,{icon:"arrow-right",iconSize:h[u],style:{margin:"0 10px"}}),r.a.createElement(y.a,{lang:a.destination,setLang:e=>{c({destination:e}),f(e,"recentUseLangTo")},offset:i,recentUse:a.recentUseLangTo,size:u})),r.a.createElement("div",null,m.a.map((e=>r.a.createElement(s.g,{inline:!0,label:"DeepL"===e.name?"DeepL":e.name.slice(0,2),large:d,key:e.value,checked:a.selectedAPIs.includes(e.value),onChange:t=>((e,t)=>{const n=e.value;c((e=>{const a=e.selectedAPIs,r=a.indexOf(n);t?r<0&&a.push(n):r>=0&&a.splice(r,1)}))})(e,t.target.checked)})))),r.a.createElement("div",null,r.a.createElement(s.g,{inline:!0,label:"自动朗读",large:d,checked:a.autoPlay,onChange:e=>{c({autoPlay:e.target.checked})}}),r.a.createElement(s.N,{interactionKind:"hover",hoverCloseDelay:300,enforceFocus:!1,usePortal:!1,disabled:(null==o?void 0:o.vipActivated)||!1,content:r.a.createElement(r.a.Fragment,null,"这是一个会员功能，请在",r.a.createElement("a",{onClick:j},"开通会员"),"后使用。")},r.a.createElement(s.g,{inline:!0,label:"自动复制",disabled:!(null==o?void 0:o.vipActivated),checked:a.autoCopy,onChange:e=>{c({autoCopy:e.target.checked})}}))),l&&r.a.createElement("div",null,l),r.a.createElement("a",{onClick:C,className:"bp3-text-small"},"打开完整设置"))}var w=n(298),N=n(202);const T={},k=(e,t)=>Object(v.b)(e,(e=>{switch(t.type){case"set loading":return void(t.value?e[t.apiId]={loading:!0,result:{data:null,error:null}}:Object(w.a)(e,[t.apiId,"loading"],!1));case"set result":return void Object(w.a)(e,[t.apiId,"result"],t.result);case"save favorites":const n={};return Object(N.a)(e,((e,t)=>{if(!e||e.loading)return;const a=e.result.data;a&&(n[t]=Object(v.d)(a))})),void browser.runtime.sendMessage({action:"save favorite",record:{text:t.text,results:n}})}}));var A=n(299),S=n(36),I=n.n(S);var P=n(112);const L=Object(o.a)(d.a,"selectedAPIs","selectedExternalLinks","destination","autoPlay","autoCopy","recentUseLangFrom","recentUseLangTo","sourceTransformNCaml","sourceTransformNoBr","sourceTransformNoComment","tipPanelSettingsClosed","historyEnabled","favoritesEnabled"),z=Object(o.a)(d.b,["user"]),D=/^[A-Z]?[a-z]+([A-Z][a-z]*)+$/,R=/^([A-Za-z]+_)+[A-Za-z]+$/,F={small:14,middle:18,large:22};t.b=Object(a.forwardRef)((function(e,t){const{queryText:n,headerLeft:d,headerRight:m,extendOptions:f,showTextArea:b=!1,textMode:g=!1,size:E="small"}=e,[y,h]=Object(u.a)(L),[j]=Object(u.a)(z),C=(null==j?void 0:j.user)||null,w=y||L,N=F[E],S="small"===E,M="large"===E,[U,B]=Object(a.useState)(""),[q,$]=Object(a.useState)(""),[Z,_]=Object(a.useState)(""),K=Object(a.useRef)(null),[J,W]=Object(a.useState)(!1),{results:G,queryResult:H,dispatchResults:Q}=function(e,t,n,r){const[s,c]=Object(a.useReducer)(k,T),o=Object(A.a)(e),l=Object(A.a)(n),i=Object(A.a)(t),u=async(e,t,n,a)=>{let r;c({type:"set loading",apiId:t,value:!0});try{r=await browser.runtime.sendMessage({action:"translate",data:{apiCode:t,text:e,source:n}})}catch(e){if(null==a?void 0:a.canceled)return;c({type:"set result",apiId:t,result:{data:null,error:{code:"BACKGROUND_DISCONNECTED"}}})}(null==a?void 0:a.canceled)||(c({type:"set loading",apiId:t,value:!1}),r&&c({type:"set result",apiId:t,result:r}))};return Object(a.useEffect)((()=>{if(!e)return;const a=e===o&&n===l&&!I()(t,i),r={canceled:!1};return t.forEach((async t=>{a&&(null==i?void 0:i.includes(t))||u(e,t,n,r)})),()=>{r.canceled=!0}}),[t,r,e,n]),{results:s,queryResult:u,dispatchResults:c}}(Z,y?y.selectedAPIs:[],U,null==y?void 0:y.destination),[V,X]=Object(a.useState)([]),[,Y]=Object(a.useReducer)(O,{translateId:""}),{isInFavorites:ee,saveOrDelete:te}=function(e,t){const[n,r]=Object(a.useState)(!1);return Object(a.useEffect)((()=>{browser.runtime.sendMessage({action:"is text in favorites",text:e}).then(r)}),[e]),{isInFavorites:n,saveOrDelete:n?()=>{browser.runtime.sendMessage({action:"delete record in favorites",text:e}),r(!1)}:()=>{t({type:"save favorites",text:e}),r(!0)}}}(Z,Q),{sourceTransformNCaml:ne,sourceTransformNoBr:ae,sourceTransformNoComment:re}=(null==C?void 0:C.vipActivated)?Object(o.a)(y||L,["sourceTransformNCaml","sourceTransformNoBr","sourceTransformNoComment"]):{sourceTransformNCaml:!1,sourceTransformNoBr:!1,sourceTransformNoComment:!1},se=Object(a.useCallback)((e=>function(e,t){let n=e.trim();return t&&(t.sourceTransformNoBr&&(n=n.replace(/\n/g,"")),t.sourceTransformNoComment&&(n=n.replace(/\/\//g,"")),t.sourceTransformNCaml&&(D.test(n)?n=n.replace(/[A-Z]/g,((e,t)=>0===t?e.toLowerCase():" "+e.toLowerCase())):R.test(n)&&(n=n.replace(/_/g," ")))),n}(e,{sourceTransformNCaml:ne,sourceTransformNoBr:ae,sourceTransformNoComment:re})),[ne,ae,re]),ce=Object(a.useMemo)((()=>Object(l.a)((e=>{_(se(e))}),1e3)),[se]);Object(a.useEffect)((()=>{X((e=>Object(v.b)(e,(e=>{e.splice(0)}))));const e=se(n);$(e),_(e)}),[se,n]);const oe=Object(A.a)(Z);Object(a.useEffect)((()=>{w.historyEnabled&&oe!==Z&&Z&&Y({type:"save translate record",text:Z})}),[Y,Z,w.historyEnabled]),Object(a.useImperativeHandle)(t,(()=>({select:()=>{window.setTimeout((()=>{K.current&&(K.current.focus(),K.current.select())}))}})),[]);const le=r.a.createElement(s.d,{icon:r.a.createElement(s.t,{icon:"cog",iconSize:N}),small:S,large:M,minimal:!0,active:J,className:"settings",onClick:()=>{W((e=>!e))},title:"快捷设置"});return r.a.createElement("div",{id:"translate-panel",className:"size-"+E},r.a.createElement("div",{className:"header"},d,r.a.createElement("div",{className:"drag-block"}),r.a.createElement("div",{className:"right"},!!V.length&&r.a.createElement(s.d,{icon:r.a.createElement(s.t,{icon:"undo",iconSize:N}),small:S,large:M,minimal:!0,title:"返回上一次翻译",onClick:()=>{const e=Object(i.a)(V);e&&($(e),_(e)),X((e=>Object(v.b)(e,(e=>{e.pop()}))))}}),y&&r.a.createElement(r.a.Fragment,null,y.favoritesEnabled&&r.a.createElement(s.d,{icon:r.a.createElement(s.t,{icon:ee?"star":"star-empty",iconSize:N}),small:S,large:M,minimal:!0,title:ee?"从收藏夹中删除":"添加到收藏夹",onClick:te}),y.tipPanelSettingsClosed&&le,!y.tipPanelSettingsClosed&&r.a.createElement(s.D,{enforceFocus:!1,content:r.a.createElement("div",{className:"bp3-text-small",style:{width:"200px",padding:"5px"}},"添加 / 隐藏翻译源、语种切换、鼠标悬浮取词开关和显示翻译文本开关在这里。",r.a.createElement("a",{onClick:()=>{h({tipPanelSettingsClosed:!0})}},"不再提示")),canEscapeKeyClose:!1,isOpen:!y.tipPanelSettingsClosed,usePortal:!1},le)),m)),r.a.createElement(s.i,{isOpen:J,keepChildrenMounted:!0},r.a.createElement(x,{source:U,setSource:B,options:y,setOptions:h,user:C,rightOffset:g?-110:void 0,size:E},f)),r.a.createElement("div",{className:"query-text",style:{display:b?"":"none"}},r.a.createElement(s.L,{fill:!0,small:S,large:M,inputRef:e=>K.current=e,value:q,onChange:e=>{const t=e.target.value;$(t),ce(t)},onKeyDown:e=>e.stopPropagation()})),r.a.createElement("div",{className:"body"},!Z&&r.a.createElement("p",null,"请输入需要翻译的文本。"),Z&&(null==y?void 0:y.selectedAPIs.map(((e,t)=>{const n=G[e];return n&&r.a.createElement(c.a,{key:e,apiId:e,result:n,size:E,queryResult:t=>{H(Z,e,t||U)},autoPlay:y.autoPlay&&0===t,autoCopy:!!(null==C?void 0:C.vipActivated)&&y.autoPlay&&0===t,setQuery:e=>{X((e=>Object(v.b)(e,(e=>{e.push(Z)})))),_(e),$(e)}})}))),!(null==y?void 0:y.selectedAPIs.length)&&r.a.createElement(s.C,{className:"no-api",title:"你隐藏了所有翻译源",description:"请添加一个翻译源来显示翻译结果。",action:r.a.createElement(s.D,{usePortal:!1,content:r.a.createElement(s.v,null,r.a.createElement(p,null))},r.a.createElement(s.d,{icon:"add",small:S,large:M,text:"添加翻译源"}))}),!!(null==y?void 0:y.selectedExternalLinks.length)&&r.a.createElement("div",{className:"external-translators"},y.selectedExternalLinks.map((e=>{const t=P.a.find((t=>t.id===e));return t?r.a.createElement("div",{key:e},r.a.createElement(s.b,{small:S,large:M,text:t.name,target:"_blank",href:t.generateLink(Z,y.destination,U)})):null})))))}))}}]);